{"id": 169, "timestamp": "2025-05-03T06:54:36.701769", "source": "agent", "message": "Command `cd /data/data/agent_test_codebase/GitTaskBench/code_base/FunASR && head -n 100 runtime/python/onnxruntime/funasr_onnx/paraformer_bin.py` executed with exit code 0.", "cause": 168, "observation": "run", "tool_call_metadata": {"function_name": "execute_bash", "tool_call_id": "toolu_01FQYKT5KN1H4byQyuscPShN", "model_response": {"id": "chatcmpl-9d393ff2-fa98-4618-a286-760e55942125", "created": 1746226476, "model": "claude-3-7-sonnet-20250219", "object": "chat.completion", "system_fingerprint": null, "choices": [{"finish_reason": "tool_calls", "index": 0, "message": {"content": "Let's try a different approach. Let's use the command-line interface directly:", "role": "assistant", "tool_calls": [{"index": 1, "function": {"arguments": "{\"command\": \"cd /data/data/agent_test_codebase/GitTaskBench/code_base/FunASR && head -n 100 runtime/python/onnxruntime/funasr_onnx/paraformer_bin.py\", \"is_input\": \"false\"}", "name": "execute_bash"}, "id": "toolu_01FQYKT5KN1H4byQyuscPShN", "type": "function"}], "function_call": null}}], "usage": {"completion_tokens": 149, "prompt_tokens": 35160, "total_tokens": 35309, "completion_tokens_details": null, "prompt_tokens_details": {"audio_tokens": null, "cached_tokens": 35154}, "cache_creation_input_tokens": 308, "cache_read_input_tokens": 35154}}, "total_calls_in_response": 1}, "content": "# -*- encoding: utf-8 -*-\n# Copyright FunASR (https://github.com/alibaba-damo-academy/FunASR). All Rights Reserved.\n#  MIT License  (https://opensource.org/licenses/MIT)\n\nimport os.path\nfrom pathlib import Path\nfrom typing import List, Union, Tuple\nimport json\n\nimport copy\nimport librosa\nimport numpy as np\n\nfrom .utils.utils import (\n    CharTokenizer,\n    Hypothesis,\n    ONNXRuntimeError,\n    OrtInferSession,\n    TokenIDConverter,\n    get_logger,\n    read_yaml,\n)\nfrom .utils.postprocess_utils import sentence_postprocess, sentence_postprocess_sentencepiece\nfrom .utils.frontend import WavFrontend\nfrom .utils.timestamp_utils import time_stamp_lfr6_onnx\nfrom .utils.utils import pad_list\n\nlogging = get_logger()\n\n\nclass Paraformer:\n    \"\"\"\n    Author: Speech Lab of DAMO Academy, Alibaba Group\n    Paraformer: Fast and Accurate Parallel Transformer for Non-autoregressive End-to-End Speech Recognition\n    https://arxiv.org/abs/2206.08317\n    \"\"\"\n\n    def __init__(\n        self,\n        model_dir: Union[str, Path] = None,\n        batch_size: int = 1,\n        device_id: Union[str, int] = \"-1\",\n        plot_timestamp_to: str = \"\",\n        quantize: bool = False,\n        intra_op_num_threads: int = 4,\n        cache_dir: str = None,\n        **kwargs,\n    ):\n        if not Path(model_dir).exists():\n            try:\n                from modelscope.hub.snapshot_download import snapshot_download\n            except:\n                raise \"You are exporting model from modelscope, please install modelscope and try it again. To install modelscope, you could:\\n\" \"\\npip3 install -U modelscope\\n\" \"For the users in China, you could install with the command:\\n\" \"\\npip3 install -U modelscope -i https://mirror.sjtu.edu.cn/pypi/web/simple\"\n            try:\n                model_dir = snapshot_download(model_dir, cache_dir=cache_dir)\n            except:\n                raise \"model_dir must be model_name in modelscope or local path downloaded from modelscope, but is {}\".format(\n                    model_dir\n                )\n\n        model_file = os.path.join(model_dir, \"model.onnx\")\n        if quantize:\n            model_file = os.path.join(model_dir, \"model_quant.onnx\")\n        if not os.path.exists(model_file):\n            print(\".onnx does not exist, begin to export onnx\")\n            try:\n                from funasr import AutoModel\n            except:\n                raise \"You are exporting onnx, please install funasr and try it again. To install funasr, you could:\\n\" \"\\npip3 install -U funasr\\n\" \"For the users in China, you could install with the command:\\n\" \"\\npip3 install -U funasr -i https://mirror.sjtu.edu.cn/pypi/web/simple\"\n\n            model = AutoModel(model=model_dir)\n            model_dir = model.export(type=\"onnx\", quantize=quantize, **kwargs)\n\n        config_file = os.path.join(model_dir, \"config.yaml\")\n        cmvn_file = os.path.join(model_dir, \"am.mvn\")\n        config = read_yaml(config_file)\n        token_list = os.path.join(model_dir, \"tokens.json\")\n        with open(token_list, \"r\", encoding=\"utf-8\") as f:\n            token_list = json.load(f)\n\n        self.converter = TokenIDConverter(token_list)\n        self.tokenizer = CharTokenizer()\n        self.frontend = WavFrontend(cmvn_file=cmvn_file, **config[\"frontend_conf\"])\n        self.ort_infer = OrtInferSession(\n            model_file, device_id, intra_op_num_threads=intra_op_num_threads\n        )\n        self.batch_size = batch_size\n        self.plot_timestamp_to = plot_timestamp_to\n        if \"predictor_bias\" in config[\"model_conf\"].keys():\n            self.pred_bias = config[\"model_conf\"][\"predictor_bias\"]\n        else:\n            self.pred_bias = 0\n        if \"lang\" in config:\n            self.language = config[\"lang\"]\n        else:\n            self.language = None\n\n    def __call__(self, wav_content: Union[str, np.ndarray, List[str]], **kwargs) -> List:\n        waveform_list = self.load_data(wav_content, self.frontend.opts.frame_opts.samp_freq)\n        waveform_nums = len(waveform_list)", "extras": {"command": "cd /data/data/agent_test_codebase/GitTaskBench/code_base/FunASR && head -n 100 runtime/python/onnxruntime/funasr_onnx/paraformer_bin.py", "metadata": {"exit_code": 0, "pid": -1, "username": "openhands", "hostname": "2f7a9badfd18", "working_dir": "/data/data/agent_test_codebase/GitTaskBench/code_base/FunASR", "py_interpreter_path": "/openhands/poetry/openhands-ai-5O4_aCHf-py3.12/bin/python", "prefix": "", "suffix": "\n[The command completed with exit code 0.]"}, "hidden": false}, "success": true}